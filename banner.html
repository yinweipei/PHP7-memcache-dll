<!DOCTYPE html>

<html lang="en">

<head>

	<meta charset="UTF-8">

	<title>BANNER</title>

	<link rel="stylesheet" type="text/css" href="__CSS__/common.css">

	<link rel="stylesheet" type="text/css" href="__CSS__/style.css">

	<script type="text/javascript" src="__JS__/jquery-1.11.3.min.js"></script>

</head>

<body>

	<div class="menu-mask">

		<div style="text-align: center;	padding: 10px 0;">

			<span class="fs-14" style="padding: 0 5px;"><img src="__IMAGES__/menu-1.png"></span>

			<span class="fs-14">[{:get_nickname()}]</span>

		</div>

		<div class="menu-list">

			<li>

				<a href="javascript:void(0)" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-2.png"></div>

					<div class="menu-item t-center fs-14"><span>主页</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

			<li>

				<a href="javascript:void(0)" class="one-level-menu mene_color">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-3.png"></div>

					<div class="menu-item t-center fs-14"><span>基础</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right right-rotate"></span></div>

				</a>

				<div class="two-level-menu show" style="display:block;">

					<a href="[{:U('brand/index')}]" class="two-menu-item t-center fs-14"><span>品牌</span></a>

					<a href="[{:U('banner/index')}]" class="two-menu-item t-center fs-14"><span>BANNER</span></a>

					<a href="[{:U('keyword/index')}]" class="two-menu-item t-center fs-14"><span>关键词</span></a>

				</div>

			</li>

			<li>

				<a href="javascript:void(0)" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-4.png"></div>

					<div class="menu-item t-center fs-14"><span>商品</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

				<div class="two-level-menu">

					<a href="[{:U('classify/index')}]" class="two-menu-item t-center fs-14"><span>分类</span></a>

					<a href="[{:U('attribution/index')}]" class="two-menu-item t-center fs-14"><span>属性</span></a>

					<a href="[{:U('goods/index')}]" class="two-menu-item t-center fs-14"><span>列表</span></a>

				</div>

			</li>

			<li>

				<a href="[{:U('thematic/index')}]" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-5.png"></div>

					<div class="menu-item t-center fs-14"><span>专题</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

			<li>

				<a href="[{:U('order/index')}]" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-6.png"></div>

					<div class="menu-item t-center fs-14"><span>订单</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

			<li>

				<a href="javascript:void(0)" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-7.png"></div>

					<div class="menu-item t-center fs-14"><span>营销</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

			<li>

				<a href="[{:U('member/index')}]" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-8.png"></div>

					<div class="menu-item t-center fs-14"><span>会员</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

			<li>

				<a href="javascript:void(0)" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-9.png"></div>

					<div class="menu-item t-center fs-14"><span>分销</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

				<div class="two-level-menu show">

					<a href="[{:U('memberadviser/index')}]" class="two-menu-item t-center fs-14"><span>我的团队</span></a>

					<a href="[{:U('memberadviser/money')}]" class="two-menu-item t-center fs-14"><span>资金明细</span></a>

					<a href="[{:U('memberadviser/order')}]" class="two-menu-item t-center fs-14"><span>订单明细</span></a>

				</div>

			</li>

			<li>

				<a href="javascript:void(0)" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-10.png"></div>

					<div class="menu-item t-center fs-14"><span>评论</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

			<li>

				<a href="javascript:void(0)" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-11.png"></div>

					<div class="menu-item t-center fs-14"><span>物流</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

			<li>

				<a href="javascript:void(0)" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-12.png"></div>

					<div class="menu-item t-center fs-14"><span>分析</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

			<li>

				<a href="javascript:void(0)" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-13.png"></div>

					<div class="menu-item t-center fs-14"><span>微信</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

			<li>

				<a href="javascript:void(0)" class="one-level-menu">

					<div class="menu-item t-left menu-icon"><img src="__IMAGES__/menu-14.png"></div>

					<div class="menu-item t-center fs-14"><span>系统</span></div>

					<div class="menu-item t-right menu-icon-right"><span class="icon-right"></span></div>

				</a>

			</li>

		</div>

	</div>

	<div class="page-top">

		<img src="__IMAGES__/logo2.png">

		<span class="close" data-link="[{:U('Outlogin/index')}]"><img src="__IMAGES__/close.png"></span>

		<span class="fs-14" style="margin-left:15px;font-weight: bold;">颜控村后台管理系统</span>

	</div>

	<div class="page-con clearfix">

		<div class="page-left left">

			<div class="page-list p-l50">

				<div style="margin-top:10px;margin-bottom:15px;">

					<neq name="_GET['status']" value="-1">

					<button type="button" class="btn add-bar-btn" data-link="[{:U('operate',array('type'=>'add'))}]">+新增</button>

					<button type="button" class="btn" id="del-btn" data-link="[{:U('operate',array('type'=>'status'))}]">删除</button>

					<else/>

					<button type="button" class="btn recovery-btn" id="del-btn" data-link="[{:U('operate',array('type'=>'status','status'=>1))}]">恢复</button>

					</neq>

				</div>

				<div class="list-mask">

					<form id="show_list">

						<table class="table table-bordered">

			                <thead>

			                    <tr>

			                     <th style="width:38px">

			                        <div class="checkbox" style="padding:0px; margin:0px;">

			                          <label style="padding:0px;">

			                            <input type="checkbox" id="CheckAll" style="display:none">

			                            <span class="text"></span></label>

			                        </div>

			                         </th>

			                        <th>

			                        	 ID

			                        </th>

			                        <th>

			                        	 排序

			                        </th>

			                        <th>

			                            名称

			                        </th>

			                        <th>

			                           描述

			                        </th>

			                        <th>

			                        	位置

			                        </th>

			                    </tr>

			                </thead>

			                <tbody>

				                <foreach name="_list" item="value">

				                <tr>

				               		<td style="width:38px"> <div class="checkbox" style="padding:0px; margin:0px;">

				                        <label style="padding:0px;">

				                          <input type="checkbox" name="id[]" value="[{$value['id']}]" style="display:none" data-link="[{:U('operate',array('type'=>'edit','id'=>$value['id']))}]">

				                          <span class="text checkbox"></span>

				                        </label>

				                      </div>

				                    </td>

				               		<td>

				                        [{$value['id']}]

				                    </td>

				                    <td>

				                     	[{$value['sort']}]

				                    </td>

				                    <td>

				                      [{$value['title']}]

				                    </td>

				                    <td>

				                       [{$value['description']}]

				                    </td>

				                    <td>

				                       <eq name="value['type']" value="1">首页轮播</eq><eq name="value['type']" value="2">热销榜单</eq><eq name="value['type']" value="3">本周最新</eq><eq name="value['type']" value="4">首页专题</eq>

				                    </td>

				                </tr>

								</foreach>

			                </tbody>

		            	</table>

	            	</form>

				</div>

				<div class="paging-list clearfix">

				 	<if condition="$count gt 10">

				 	<span>共[{$count}]条</span>

				 	[{$_page}]

					</if>

		        </div>

			</div>

			<div class="page-l-bottom clearfix">

				<div class="up-pic-mask">

					<div class="up-pic none">

						<div class="imgup-mask">

		                	<input type="file" name="imageUpload" class="upload-img" />

		                	<div class="preview-img" preview>

			                 	<img src="" alt="">

			            	</div>

		            	</div>

		            	<div class="m-t10 fs-tip t-center">注意：首页广告的图片尺寸宽高为750px x 500px</div>

		            	<div class="m-t10 fs-tip t-center">注意：热销榜单的图片尺寸宽高为480px x 540px</div>

		            	<div class="m-t10 fs-tip t-center">注意：本周最新的图片尺寸宽高为750px x 500px</div>

					</div>

				</div>

				<div class="empty"></div>

			</div>

		</div>

		<div class="page-right left">

			<form action="[{:U('index')}]">

			<div class="page-r-top" style="padding-top:10px;">

				<div class="m-t10">

					<label class="fs-14 m-r6 label-w">查询类型:</label>

					<div style="width:150px;height: 25px;display: inline-block;position: relative;">

						<input type="text" class="t-input-3" value="<notempty name="_GET['status']"><eq name="_GET['status']" value="1">正常查询</eq><eq name="_GET['status']" value="-1">查询已删除数据</eq><else />正常查询</notempty>" placeholder="请选择" id="one-level-cate">

						<span class="drop-icon"></span>

						<select class="select" name="status">

						  <option value ="1" <eq name="_GET['status']" value="1">selected</eq>>正常查询</option>

						  <option value ="-1" <eq name="_GET['status']" value="-1">selected</eq>>查询已删除数据</option>

						</select>

					</div>

				</div>

				<div class="m-t10">

					<label class="fs-14 m-r6 label-w">ID:</label>

					<input type="text" name="id" placeholder="请输入ID" class="t-input">

				</div>

				<div class="m-t10">

					<label class="fs-14 m-r6 label-w">名称:</label>

					<input type="text" name="title" placeholder="请输入名称" class="t-input">

				</div>

				<div class="m-t10">

					<label class="fs-14 m-r6 label-w">位置:</label>

					<div style="width:150px;height: 25px;display: inline-block;position: relative;">

						<input type="text" class="t-input-3" value="<notempty name="_GET['type']"><eq name="value['type']" value="1">首页轮播</eq><eq name="_GET['type']" value="2">热销榜单</eq><eq name="_GET['type']" value="3">本周最新</eq><else />全部</notempty>" placeholder="请选择" id="one-level-cate">

						<span class="drop-icon"></span>

						<select class="select" name="type">

						  <option value ="">全部</option>

						  <option value ="1" <eq name="_GET['type']" value="1">selected</eq>>首页轮播</option>

						  <option value ="2" <eq name="_GET['type']" value="2">selected</eq>>热销榜单</option>

						  <option value ="3" <eq name="_GET['type']" value="3">selected</eq>>本周最新</option>

						</select>

					</div>

				</div>

				<div class="m-t20"><button type="submit" class="btn m-l-150">查询</button></div>

			</div>

			</form>

			<div class="page-r-bottom" style="padding-top:20px;">

				<form class="page-r-bottom-con none" id="edit_form">

					<div class="m-t10">

						<label class="fs-14 m-r6 label-w">位置:</label>

						<div style="width:150px;height: 25px;display: inline-block;position: relative;">

							<input type="text" class="t-input-3 n_location" value="全部" placeholder="请选择">

							<span class="drop-icon"></span>

							<select class="select banner_select" name="type">

								<option value ="1">首页轮播</option>

								<option value ="2">热销榜单</option>

								<option value ="3">本周最新</option>

							</select>

						</div>

						<!-- <button type="button" class="set-top-btn">置顶</button> -->

					</div>

					<div class="m-t10"><label class="fs-14 m-r6 label-w">ID:</label><label class="fs-14 n_id">005</label></div>

					<div class="m-t10">

						<label class="fs-14 m-r6 label-w">排序:</label>

						<input type="text" class="t-input-4 n_num" name="sort">

					</div>

					<div class="m-t10">

						<label class="fs-14 m-r6 label-w">名称:</label>

						<input type="text" class="t-input n_name" name="title">

					</div>

					<div class="m-t10 none">

						<label class="fs-14 m-r6 label-w">图片路径:</label>

						<input type="text" class="t-input n_img_path" name="img_path">

					</div>

					<div class="m-t10 relative">

						<label class="fs-14 m-r6 label-w" style="position:absolute;top:0">描述:</label>

						<textarea class="t-textarea n_des" name="description"></textarea>

					</div>

					<div class="m-t10 goods-des none">

						<label class="fs-14 m-r6 label-w">跳转链接:</label>

						<div class="relative" style="display: inline-block;font-size: 14px;">

                          	<input type="radio" name="url" value="1" checked style="width: 15px;height: 15px;margin: 0 2px 0 0;">可为链接
							<input type="radio" name="url" value="2" style="width: 15px;height: 15px;margin: 0 2px 0 10px;">可纯展示

						</div>

						<div class="m-t10 goods-link" style="margin-left: 110px;">

							<input type="text" class="t-input n_link" name="link">

						</div>

						<div class="m-t10">

							<table class="table goods-table" style="margin-left:60px;width:250px;">

				                <thead>

				                    <tr>

				                        <th>

				                        	 货号

				                        </th>

				                        <th>

				                        	 名称

				                        </th>

				                        <th>

				                        </th>

				                    </tr>

				                </thead>

				                <tbody class="goods_con">



				                </tbody>

			            	</table>

						</div>

					</div>

					<div class="m-t20"><button type="button" class="btn m-l-150 preservation-btn" data-link="">保存</button></div>

				</form>

			</div>

		</div>

	</div>

	<div class="popup-error-mask none">

		<div class="popup-error">

			<div class="popup-error-txt t-center fs-16"></div>

			<div class="popup-error-btn-mask">

				<div class="popup-error-btn">确定</div>

			</div>

		</div>

	</div>

<script type="text/javascript" src="__JS__/common.js"></script>

<script type="text/javascript">

	function attribute_del(obj){

		$(obj).parents('tr').remove();

	}

	$(".banner_select").change(function(){

		var val=$(this).val();

		val=parseInt(val);

		switch(val)

			{

				case 1:

					// $('.n_location').val('首页轮播');

					// $('#edit_form option[value ="1"]').prop("selected",true);

					$('.goods-des').removeClass('none');

					$('[preview] img').attr('src','');

					$('.up-pic').removeClass('none');

					// $('.goods-link').addClass('none');

					$('.preview-img').removeClass('preview-color');

				break;

				case 2:

					$('.n_img_path').val('');

					$('[preview] img').attr('src','');

					$('.up-pic').removeClass('none');

					// $('.n_location').val('热销榜单');

					// $('#edit_form option[value ="2"]').prop("selected",true);

					// $('.goods-link').addClass('none');

					$('.goods-des').removeClass('none');

				break;

				case 3:

					$('.n_img_path').val('');

					$('[preview] img').attr('src','');

					// $('.n_location').val('本周最新');

					// $('#edit_form option[value ="3"]').prop("selected",true);

					// $('.goods-link').addClass('none');

					$('.goods-des').removeClass('none');

				break;

			}

		console.log(val);

	});



//上传图片

$('[type=file]').change(function(e){

     //创建FormData对象

     var data = new FormData();

     //为FormData对象添加数据

     $('.preview-img').addClass('preview-color');

     var file = e.target.files[0];

     $.each($('[type=file]')[0].files, function(i, file) {

         data.append('imageFile', file);

     });

     data.append('imageFile', file);

     $.ajax({

         url:"[{:U('File/update')}]",

         type:'POST',

         data:data,

         cache: false,

         contentType: false,    //不可缺

         processData: false,    //不可缺

         success:function(data){

			console.log(data);

				if(data.status==1){

					var url=data.path;

					$('.preview-img img').attr('src',url);

					$('.preview-img').addClass('preview-color');

					$('.n_img_path').val(url);

				}

         }

     });

})

//选择是否显示链接
$('input[name="url"]').on('click',function(){
	let status = $('.relative input[name="url"]:checked').val();
	if(status == 1){
		$('.goods-link').removeClass('none');
	}else{
		$('.goods-link').addClass('none');
	}
});

////显示详情

$('input[name="id[]"]').on('click',function(){

	var leng=$('form input[name="id[]"]:checked').length;

	var data={};

	if (leng===1){

		var url=$('#show_list input[name="id[]"]:checked').attr('data-link');

		$('.n_id').parent().removeClass('none');

		$('.preservation-btn').attr('data-link',url);

		$('.preview-img').addClass('preview-color');

		$.get(url,data).success(function(res){

			console.log(res);

			if (res.status===1) {

				var goods_string=""

				$('.n_id').html(res.info.id);

				$('.n_name').val(res.info.title);

				$('.n_des').html(res.info.description);

				$('.n_num').val(res.info.sort);

				$('.n_img_path').val(res.info.img_path);

				$('[preview] img').attr('src',res.info.img_path);

				$('.n_link').val(res.info.link);

				if (res.info.goods==null) {

				}else{

					for (var i = 0; i <res.info.goods.length; i++) {

						goods_string +='<tr><td>'+res.info.goods[i].goodsnum+'</td><td>'+res.info.goods[i].goodsname+'</td><td><div class="del-icon" onclick="attribute_del(this)" style="position: relative;"></div></td><input name="goodsid[]" type="hidden" value="'+res.info.goods[i].goodsid+'"></tr>';

					};

					$('.goods_con').html(goods_string);



				}

				var type=res.info.type;

				type=parseInt(type);

				switch(type)

					{

						case 1:

							$('.n_location').val('首页轮播');

							$('#edit_form option[value ="1"]').prop("selected",true);

							// $('.goods-link').addClass('none');

							$('.n_goods_add').val('');

							$('.goods-des').removeClass('none');

							$('.up-pic').removeClass('none');

						break;

						case 2:

							$('.n_location').val('热销榜单');

							$('#edit_form option[value ="2"]').prop("selected",true);

							// $('.goods-link').addClass('none');

							$('.n_goods_add').val('');

							$('.goods-des').removeClass('none');

							$('.up-pic').removeClass('none');

						break;

						case 3:

							$('.n_location').val('本周最新');

							$('#edit_form option[value ="3"]').prop("selected",true);

							// $('.goods-link').addClass('none');

							$('.n_goods_add').val('');

							$('.goods-des').removeClass('none');

							$('.up-pic').removeClass('none');

						break;

					}

			};

		});

		$('.page-r-bottom-con').removeClass('none');

	}else{

		$('.page-r-bottom-con').addClass('none');

		$('.up-pic').addClass('none');

	}

});

//删除

$('#del-btn').on('click',function(){

	var url=$(this).attr('data-link');

	console.log(url);

	var data=$('#show_list').serialize();

	console.log($('#show_list').serialize());

	$.post(url,data).success(function(res){

		//console.log(res)

		if (res.status===1) {

			popup_tip(res.info);

			//弹窗

			$('.popup-error-mask').removeClass('none');

			$('.popup-error-btn').on('click',function(){

				window.location.href='[{:U('index')}]';//刷新当前页面.

			});

			setTimeout(function(){

				window.location.href='[{:U('index')}]';//刷新当前页面.

			},3000)

		};

	});

})

//新增

$('.add-bar-btn').on('click',function(){

	//清空,初始化

	$('.preview-img').removeClass('preview-color');

	$('.n_id').html('');

	$('.n_id').parent().addClass('none');

	$('.n_name').val('');

	$('.n_des').html('');

	$('.n_num').val('');

	$('.n_goods_add').val('');

	$('.n_img_path').val('');

	$('[preview] img').attr('src','');

	$('.n_link').val('');

	$('.n_location').val('首页轮播');

	$('#edit_form option[value ="1"]').prop("selected",true);

	// $('.goods-link').addClass('none');

	$('.goods-des').removeClass('none');

	$('form input[name="id[]"]').each(function(){

	 	 $(this).removeAttr("checked",false);

	 })

	var url=$(this).attr('data-link');

	$('.preservation-btn').attr('data-link',url);

	$('.page-r-bottom-con').removeClass('none');

	$('.up-pic').removeClass('none');

})



$('.preservation-btn').on('click',function(){

		var url=$(this).attr('data-link');

		var data=$('#edit_form').serialize();

		// if ($(".banner_select")) {};

		var leng=$('.goods_con tr').length;

		/*if (leng<1) {

				//弹窗

				popup_tip("商品不能为空");

				$('.popup-error-mask').removeClass('none');

				$('.popup-error-btn').on('click',function(){

					$('.popup-error-mask').addClass('none');

				});

				return false;

			};*/

		$.post(url,data).success(function(res){

			console.log(res);

			if (res.status===1) {

				console.log(5858);

				popup_tip(res.info);

				//弹窗

				$('.popup-error-mask').removeClass('none');

				$('.popup-error-btn').on('click',function(){

					window.location.href='[{:U('index')}]';//刷新当前页面.

				});

				setTimeout(function(){

					window.location.href='[{:U('index')}]';//刷新当前页面.

				},3000)

			};

		});

	})

$('.n_goods_add').on('input propertychange',function(){

	var url="[{:U('goods/operate',array('type'=>'search'))}]";

	var a_value=$(this).val();

	$.ajax({

     	url: url,

            dataType:"json",

            type:"POST",

            data:{

              search:a_value,

            },

            success:function(req){

                console.log(req);

                var string=""

                // console.log(req.list.length);

                if (req.status===1) {

                    if (req.list.length>0) {

	                    console.log(121212)

	                    for (var i = 0; i <req.list.length; i++) {

	                    string +='<li n_goodsname="'+req.list[i].goodsname+'" n_goodsnum="'+req.list[i].goodsnum+'" n_goodsid="'+req.list[i].goodsid+'">'+req.list[i].goodsname+'</li>'

                      	};

	                    $('#goods_select').html(string);

	                    $('#goods_select').fadeIn(10);

	                    $('#goods_select li').on('click',function(){

	                        $('#goods_select').fadeOut(10);

	                        var goodsnum=$(this).attr('n_goodsnum');

	                        var goodsname=$(this).attr('n_goodsname');

	                        var goodsid=$(this).attr('n_goodsid');

	 						var goods_string ='<tr><td>'+goodsnum+'</td><td>'+goodsname+'</td><td><div class="del-icon" onclick="attribute_del(this)" style="position: relative;"></div></td><input name="goodsid[]" type="hidden" value="'+goodsid+'"></tr>'

	                        $('.goods_con').html(goods_string);

	                    });

                    }else{

                        $('#goods_select').fadeOut(10);

                    }



                }else{

                	$('#goods_select').fadeOut(10);

                }

            },

  });

})

</script>

</body>

</html>